import pathlib

from sat_sav_parse.logger import (
    ContextFilter,
    disable_logging_hell,
    enable_logging_hell,
    logging_with_context,
    prepare_logging_hell,
)

from .exceptions import ParseError
from .models import (
    ActorHeader,
    ActorObject,
    ArrayElementByte,
    ArrayElementEnum,
    ArrayElementFloat,
    ArrayElementInt,
    ArrayElementInt64,
    ArrayElementInterface,
    ArrayElementObject,
    ArrayElementSoftObject,
    ArrayElementStr,
    ArrayElementStruct,
    ArrayElementStructValueType,
    ArrayElementType,
    ArrayElementTypeName,
    ArrayProperty,
    BaseArrayElement,
    BaseProperty,
    BoolProperty,
    Box,
    ByteProperty,
    ClientIdentityInfo,
    ClientIdentityInfoIdentity,
    ClientIdentityInfoIdentityVariant,
    ComponentHeader,
    ComponentObject,
    CSaveFileBody,
    CSaveFileChunk,
    DateTime,
    DoubleProperty,
    EnumProperty,
    FloatProperty,
    FluidBox,
    GridName,
    HeaderType,
    Int8Property,
    Int64Property,
    IntProperty,
    InventoryItem,
    KeyTypeName,
    Level,
    LevelGroupingGrid,
    LevelInfo,
    LevelObjectType,
    LinearColor,
    MapKeyType,
    MapKeyValue,
    MapProperty,
    NameProperty,
    ObjectHeaderType,
    ObjectProperty,
    ObjectReference,
    PropertyType,
    PropertyTypeName,
    Quat,
    Quaternion,
    RailroadTrackPosition,
    SaveFileBody,
    SaveFileHeader,
    SessionVisibility,
    SetProperty,
    SetType,
    SoftObjectProperty,
    SpawnData,
    StrProperty,
    StructProperty,
    StructTypeName,
    TextArgument,
    TextArgumentInt,
    TextArgumentText,
    TextArgumentType,
    TextProperty,
    TextPropertyHistoryType,
    TextValue,
    TextValueBase,
    TextValueNone,
    TextValueStringTableEntry,
    TextValueTransform,
    TextValueWithArguments,
    UInt32Property,
    ValueTypeName,
    Vector,
    Vector3,
)
from .structs import (
    SFSaveDeserializable,
    SFSaveDeserializeFn,
    SFSaveDeserializer,
    SFSaveSerializable,
    SFSaveSerializeFn,
    SFSaveSerializer,
)

__all__ = (
    "ActorHeader",
    "ActorHeader",
    "ActorObject",
    "ActorObject",
    "ArrayElementByte",
    "ArrayElementEnum",
    "ArrayElementFloat",
    "ArrayElementInt",
    "ArrayElementInt64",
    "ArrayElementInterface",
    "ArrayElementObject",
    "ArrayElementSoftObject",
    "ArrayElementStr",
    "ArrayElementStruct",
    "ArrayElementStructValueType",
    "ArrayElementType",
    "ArrayElementTypeName",
    "ArrayProperty",
    "BaseArrayElement",
    "BaseProperty",
    "BoolProperty",
    "Box",
    "ByteProperty",
    "CSaveFileBody",
    "CSaveFileBody",
    "CSaveFileChunk",
    "CSaveFileChunk",
    "ClientIdentityInfo",
    "ClientIdentityInfoIdentity",
    "ClientIdentityInfoIdentityVariant",
    "ComponentHeader",
    "ComponentHeader",
    "ComponentObject",
    "ComponentObject",
    "ContextFilter",
    "DateTime",
    "DoubleProperty",
    "EnumProperty",
    "FloatProperty",
    "FluidBox",
    "GridName",
    "GridName",
    "HeaderType",
    "HeaderType",
    "Int8Property",
    "Int64Property",
    "IntProperty",
    "InventoryItem",
    "KeyTypeName",
    "Level",
    "LevelGroupingGrid",
    "LevelGroupingGrid",
    "LevelInfo",
    "LevelInfo",
    "LevelObjectType",
    "LevelObjectType",
    "LinearColor",
    "MapKeyType",
    "MapKeyValue",
    "MapProperty",
    "NameProperty",
    "ObjectHeaderType",
    "ObjectHeaderType",
    "ObjectProperty",
    "ObjectReference",
    "ParseError",
    "PropertyType",
    "PropertyTypeName",
    "Quat",
    "Quaternion",
    "Quaternion",
    "RailroadTrackPosition",
    "SFSaveDeserializable",
    "SFSaveDeserializeFn",
    "SFSaveDeserializer",
    "SFSaveSerializable",
    "SFSaveSerializeFn",
    "SFSaveSerializer",
    "SaveFileBody",
    "SaveFileBody",
    "SaveFileHeader",
    "SaveFileHeader",
    "SessionVisibility",
    "SessionVisibility",
    "SetProperty",
    "SetType",
    "SoftObjectProperty",
    "SpawnData",
    "StrProperty",
    "StructProperty",
    "StructTypeName",
    "TextArgument",
    "TextArgumentInt",
    "TextArgumentText",
    "TextArgumentType",
    "TextProperty",
    "TextPropertyHistoryType",
    "TextValue",
    "TextValueBase",
    "TextValueNone",
    "TextValueStringTableEntry",
    "TextValueTransform",
    "TextValueWithArguments",
    "UInt32Property",
    "ValueTypeName",
    "Vector",
    "Vector3",
    "Vector3",
    "disable_logging_hell",
    "enable_logging_hell",
    "logging_with_context",
    "parse_save_file",
    "prepare_logging_hell",
)

prepare_logging_hell()


def parse_save_file(file_path: pathlib.Path) -> tuple[SaveFileHeader, SaveFileBody]:
    with file_path.open("rb") as f:
        des = SFSaveDeserializer(f.read())
    header = des.get(SaveFileHeader)
    decompressed = des.get(CSaveFileBody)
    dec_des = SFSaveDeserializer(decompressed)
    return header, dec_des.get(SaveFileBody)
